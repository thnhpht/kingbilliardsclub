{% extends 'main.html' %} {% load static %} {% block content %}
<h1>Live Scores</h1>

<!-- <div class="d-flex bg-white w-100 justify-content-around align-items-center">
  <h3>T1</h3>
  <div class="d-flex justify-content-around align-items-center w-300">
    <p>Ph√°t</p>
    <p>7</p>
  </div>
  <div class="d-flex justify-content-around align-items-center w-300">
    <p>Huy</p>
    <p>6</p>
  </div>
</div> -->
<div class="round">
  {% for round in rounds %}
  <div class="round-name">{{ round.round }}</div>
  <table class="table table-striped table-responsive text-nowrap">
    <tbody>
      
        {% for duel in duels %}
          {% if round.id == duel.round.id %}
            <tr>
              <th scope="row">{{ duel.table }}</th>
              <td class="col-3">{{ duel.player1 }}</td>
              <td>{{ duel.score1 }}</td>

              {% if user.is_authenticated %}
                {% if action == 'start' and duel.pk|stringformat:"s" == pk %}
                  <form action="{% url 'live_scores' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="increase_score_player1" />
                    <input type="hidden" name="pk" value="{{ duel.pk }}" />
                    <input type="hidden" name="score_player1" value="{{ duel.score1 }}" />
                    <td>
                      <button type="submit" class="btn">
                        <i class="fa-solid fa-caret-up"></i>
                      </button>
                    </td>
                  </form>
                  <form action="{% url 'live_scores' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="decrease_score_player1" />
                    <input type="hidden" name="pk" value="{{ duel.pk }}" />
                    <input type="hidden" name="score_player1" value="{{ duel.score1 }}" />
                    <td>
                      <button type="submit" class="btn">
                        <i class="fa-solid fa-caret-down"></i>
                      </button>
                    </td>
                  </form>
                {% endif %}
              {% endif %}
              
              <td>VS</td>
              <td class="col-3">{{ duel.player2 }}</td>
              <td>{{ duel.score2 }}</td>

              {% if user.is_authenticated %}
                {% if action == 'start' and duel.pk|stringformat:"s" == pk %}
                  <form action="{% url 'live_scores' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="increase_score_player2" />
                    <input type="hidden" name="pk" value="{{ duel.pk }}" />
                    <input type="hidden" name="score_player2" value="{{ duel.score2 }}" />
                    <td>
                      <button type="submit" class="btn">
                        <i class="fa-solid fa-caret-up"></i>
                      </button>
                    </td>
                  </form>
                  <form action="{% url 'live_scores' %}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="action" value="decrease_score_player2" />
                    <input type="hidden" name="pk" value="{{ duel.pk }}" />
                    <input type="hidden" name="score_player2" value="{{ duel.score2 }}" />
                    <td>
                      <button type="submit" class="btn">
                        <i class="fa-solid fa-caret-down"></i>
                      </button>
                    </td>
                  </form>
                {% endif %}
              {% endif %}

              <td class="col-1">{{ duel.date|date:'d-m-Y' }}</td>
              <td>{{ duel.time|time:'H:i' }}</td>
              <td>{{ duel.stop_time|time:'H:i' }}</td>
              
              {% if user.is_authenticated %}
                {% if duel.stop_time is null %}
                  {% if action == 'start' and duel.pk|stringformat:"s" == pk %}
                    <td id="server-time"></td>
                    <form action="{% url 'live_scores' %}" method="post">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="stop" />
                      <input type="hidden" name="pk" value="{{ duel.pk }}" />
                      <td><input type="submit" value="Stop" class="btn btn-danger" /></td>
                    </form>
                  {% else %}
                    <form action="{% url 'live_scores' %}" method="post">
                      {% csrf_token %}
                      <input type="hidden" name="action" value="start" />
                      <input type="hidden" name="pk" value="{{ duel.pk }}" />
                      <td>
                        <input type="submit" value="Start" class="btn btn-primary" />
                      </td>
                    </form>
                  {% endif %}
                {% endif %}
              {% endif %}
            </tr>
          {% endif %}
        {% endfor %}
    </tbody>
  </table>
  {% endfor %}
</div>

{% endblock content %}
